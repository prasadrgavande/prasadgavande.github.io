<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p><img src="https://raw.githubusercontent.com/prasadrgavande/prasadgavande.github.io/refs/heads/master/assets/img/7-Ansible-guide/Ansible.png" alt="Ansible"></p> <p>In the world of DevOps, the “inner development loop”—the time between writing code and testing it—is critical. Waiting for cloud instances to provision or fighting with heavy virtual machines (VMs) adds unnecessary friction to this loop.</p> <p>This guide details the architecture and implementation of a high-fidelity, local infrastructure lab using <strong>Windows Subsystem for Linux (WSL 2)</strong> and <strong>Docker</strong>. This setup allows engineers to simulate a multi-environment pipeline (TEST, UAT, PRD) with minimal resource overhead, perfect for developing and testing <strong>Ansible</strong> automation before deployment.</p> <p><strong>Who is this for?</strong> Complete beginners. You need zero prior knowledge of Ansible to follow this.</p> <hr> <h2 id="prerequisites">Prerequisites</h2> <p>Before we start, ensure you have the following installed:</p> <ol> <li> <strong>WSL 2 (Windows Subsystem for Linux)</strong>: We will use Ubuntu as our command center.</li> <li> <strong>Ansible</strong> installed on WSL2</li> <li> <strong>Docker Desktop for Windows</strong>: This runs our “servers.”</li> <li> <strong>VS Code</strong>: For editing files.</li> </ol> <p><strong>Critical Setup Step:</strong></p> <p>Try to check docker version from your WSL</p> <p><img src="https://github.com/prasadrgavande/prasadgavande.github.io/blob/master/assets/img/7-Ansible-guide/1-docker--version1.png?raw=true" alt="dockerNotVisible"></p> <p>If it is not showing as below then</p> <p>Ensure Docker Desktop is talking to your WSL distro. Go to <strong>Settings &gt; Resources &gt; WSL Integration</strong> and toggle your Ubuntu distribution ON.</p> <p><img src="https://github.com/prasadrgavande/prasadgavande.github.io/blob/master/assets/img/7-Ansible-guide/2-enableWSLIntegrationInDockerDesktop.png?raw=true" alt="EnableDockerIntegration"></p> <p>Open your Ubuntu terminal and verify everything is ready:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nt">--version</span>
</code></pre></div></div> <p><img src="https://github.com/prasadrgavande/prasadgavande.github.io/blob/master/assets/img/7-Ansible-guide/3-docker--version.png?raw=true" alt="DockerVersion"></p> <hr> <h2 id="phase-1-building-your-data-center-infrastructure">Phase 1: Building Your “Data Center” (Infrastructure)</h2> <p>We need three servers. Instead of heavy VMs, we will use lightweight Docker containers. However, standard Docker containers are “stripped down” and don’t allow SSH logins. We need to build a custom image that acts like a real server.</p> <h3 id="step-1-create-your-workspace">Step 1: Create Your Workspace</h3> <p>Open your WSL terminal and create a dedicated folder for this project.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/my-ansible-lab
<span class="nb">cd</span> ~/my-ansible-lab
</code></pre></div></div> <h3 id="step-2-create-the-server-image">Step 2: Create the “Server” Image</h3> <p>We will define a Docker image that has OpenSSH (so Ansible can log in), Python (so Ansible can run tasks), and Sudo (for admin rights).</p> <p>Create a file named <code class="language-plaintext highlighter-rouge">Dockerfile</code> (no extension) in your folder:</p> <div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Use the official Ubuntu image as our foundation</span>
<span class="k">FROM</span><span class="s"> ubuntu:latest</span>

<span class="c"># Install the "Plumbing" Ansible needs:</span>
<span class="c"># 1. openssh-server: To allow remote login</span>
<span class="c"># 2. python3: To execute Ansible modules</span>
<span class="c"># 3. sudo: To perform admin tasks</span>
<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get <span class="nb">install</span> <span class="nt">-y</span> openssh-server python3 <span class="nb">sudo</span>

<span class="c"># Configure 3 Users for our 3 Environments (Simulating Real World Access)</span>
<span class="c"># We create users 'ansible-test', 'ansible-uat', and 'ansible-prd'</span>
<span class="c"># We set the password 'password' for all of them for simplicity</span>
<span class="k">RUN </span>useradd <span class="nt">-rm</span> <span class="nt">-d</span> /home/ansible-test <span class="nt">-s</span> /bin/bash <span class="nt">-g</span> root <span class="nt">-G</span> <span class="nb">sudo </span>ansible-test <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s1">'ansible-test:password'</span> | chpasswd

<span class="k">RUN </span>useradd <span class="nt">-rm</span> <span class="nt">-d</span> /home/ansible-uat <span class="nt">-s</span> /bin/bash <span class="nt">-g</span> root <span class="nt">-G</span> <span class="nb">sudo </span>ansible-uat <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s1">'ansible-uat:password'</span> | chpasswd

<span class="k">RUN </span>useradd <span class="nt">-rm</span> <span class="nt">-d</span> /home/ansible-prd <span class="nt">-s</span> /bin/bash <span class="nt">-g</span> root <span class="nt">-G</span> <span class="nb">sudo </span>ansible-prd <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">echo</span> <span class="s1">'ansible-prd:password'</span> | chpasswd

<span class="c"># Set up the SSH directory</span>
<span class="k">RUN </span><span class="nb">mkdir</span> <span class="nt">-p</span> /run/sshd

<span class="c"># Expose Port 22 (The standard SSH port)</span>
<span class="k">EXPOSE</span><span class="s"> 22</span>

<span class="c"># Start the SSH Daemon when the container boots</span>
<span class="k">CMD</span><span class="s"> ["/usr/sbin/sshd", "-D"]</span>
</code></pre></div></div> <h3 id="step-3-build-the-image">Step 3: Build the Image</h3> <p>Run this command to build your custom server image. We will tag it <code class="language-plaintext highlighter-rouge">ubuntu-base</code>.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> ubuntu-base <span class="nb">.</span>
</code></pre></div></div> <p><img src="https://github.com/prasadrgavande/prasadgavande.github.io/blob/master/assets/img/7-Ansible-guide/4-ubuntu-base-installation.png?raw=true" alt="Building Docker Image"></p> <h3 id="step-4-launch-the-fleet">Step 4: Launch the Fleet</h3> <p>Now we spin up three separate containers. We map their internal SSH port (22) to different ports on your localhost so we can target them individually.</p> <ul> <li> <strong>TEST Server:</strong> Accessible on port 2222</li> <li> <strong>UAT Server:</strong> Accessible on port 2223</li> <li> <strong>PRD Server:</strong> Accessible on port 2224</li> </ul> <p>Run these three commands:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-d</span> <span class="nt">-p</span> 2222:22 <span class="nt">--name</span> test-server ubuntu-base
docker run <span class="nt">-d</span> <span class="nt">-p</span> 2223:22 <span class="nt">--name</span> uat-server ubuntu-base
docker run <span class="nt">-d</span> <span class="nt">-p</span> 2224:22 <span class="nt">--name</span> prd-server ubuntu-base
</code></pre></div></div> <p>Verify they are running:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ps
</code></pre></div></div> <p><img src="https://github.com/prasadrgavande/prasadgavande.github.io/blob/master/assets/img/7-Ansible-guide/5-create-containers.png?raw=true" alt="Verify Containers"></p> <hr> <h2 id="phase-2-setting-up-ansible-the-control-center">Phase 2: Setting Up Ansible (The Control Center)</h2> <p>Now that we have servers, we need to configure Ansible to talk to them.</p> <h3 id="step-1-create-professional-folder-structure">Step 1: Create Professional Folder Structure</h3> <p>We will use <strong>Ansible Roles</strong>, which is the industry standard for organizing code. Run these commands to create the folders:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create directories for roles</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> roles/common/tasks
<span class="nb">mkdir</span> <span class="nt">-p</span> roles/nginx/tasks

<span class="c"># Create directories for config and playbooks</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> inventory
<span class="nb">mkdir</span> <span class="nt">-p</span> playbooks
</code></pre></div></div> <h3 id="step-2-the-inventory-file-hostsini">Step 2: The Inventory File (<code class="language-plaintext highlighter-rouge">hosts.ini</code>)</h3> <p>This file acts as an address book for Ansible. Create <code class="language-plaintext highlighter-rouge">inventory/hosts.ini</code>:</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[test]</span><span class="w">
</span><span class="na">test-node</span><span class="w"> </span><span class="py">ansible_host</span><span class="p">=</span><span class="s">localhost ansible_port=2222 ansible_user=ansible-test</span>
<span class="w">
</span><span class="nn">[uat]</span><span class="w">
</span><span class="na">uat-node</span><span class="w"> </span><span class="py">ansible_host</span><span class="p">=</span><span class="s">localhost ansible_port=2223 ansible_user=ansible-uat</span>
<span class="w">
</span><span class="nn">[prd]</span><span class="w">
</span><span class="na">prd-node</span><span class="w"> </span><span class="py">ansible_host</span><span class="p">=</span><span class="s">localhost ansible_port=2224 ansible_user=ansible-prd</span>
<span class="w">
</span><span class="c"># Create a group that contains all environments
</span><span class="nn">[docker_lab:children]</span><span class="w">
</span><span class="na">test</span><span class="w">
</span><span class="na">uat</span><span class="w">
</span><span class="na">prd</span><span class="w">

</span><span class="c"># Define variables for the group
</span><span class="nn">[docker_lab:vars]</span><span class="w">
</span><span class="c"># The password we baked into the Dockerfile
</span><span class="py">ansible_ssh_pass</span><span class="p">=</span><span class="s">password</span>
<span class="py">ansible_become_pass</span><span class="p">=</span><span class="s">password</span>
<span class="c"># Prevent "Host Verification" errors since these are local containers
</span><span class="py">ansible_ssh_common_args</span><span class="p">=</span><span class="s">'-o StrictHostKeyChecking=no'</span>
<span class="c"># Explicitly use Python 3
</span><span class="py">ansible_python_interpreter</span><span class="p">=</span><span class="s">/usr/bin/python3</span>
</code></pre></div></div> <h3 id="step-3-ansible-configuration-ansiblecfg">Step 3: Ansible Configuration (<code class="language-plaintext highlighter-rouge">ansible.cfg</code>)</h3> <p>Create a file named <code class="language-plaintext highlighter-rouge">ansible.cfg</code> in the root folder (<code class="language-plaintext highlighter-rouge">~/my-ansible-lab</code>). This tells Ansible where to find everything.</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[defaults]</span><span class="w">
</span><span class="py">inventory</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">./inventory/hosts.ini</span>
<span class="py">host_key_checking</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">False</span>
<span class="c"># Use YAML format for cleaner output
</span><span class="py">stdout_callback</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">yaml</span>
<span class="c"># Tell Ansible where to find our roles
</span><span class="py">roles_path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">./roles</span>
</code></pre></div></div> <hr> <h2 id="phase-3-writing-the-automation-code">Phase 3: Writing the Automation Code</h2> <p>We will create two “Roles”. Roles are like functions in programming—reusable blocks of tasks.</p> <h3 id="step-1-the-common-role">Step 1: The ‘Common’ Role</h3> <p>This role installs basic utilities on every server. Create <code class="language-plaintext highlighter-rouge">roles/common/tasks/main.yml</code>:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install common utilities</span>
  <span class="na">ansible.builtin.apt</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">curl</span>
      <span class="pi">-</span> <span class="s">wget</span>
      <span class="pi">-</span> <span class="s">git</span>
      <span class="pi">-</span> <span class="s">vim</span>
    <span class="na">state</span><span class="pi">:</span> <span class="s">present</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Create a welcome message</span>
  <span class="na">ansible.builtin.copy</span><span class="pi">:</span>
    <span class="na">content</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Welcome</span><span class="nv"> </span><span class="s">to</span><span class="nv">  </span><span class="s">environment!"</span>
    <span class="na">dest</span><span class="pi">:</span> <span class="s">/etc/motd</span>
    <span class="na">owner</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">group</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">mode</span><span class="pi">:</span> <span class="s1">'</span><span class="s">0644'</span>
</code></pre></div></div> <h3 id="step-2-the-nginx-role">Step 2: The ‘Nginx’ Role</h3> <p>This role installs the web server. Since Docker doesn’t support <code class="language-plaintext highlighter-rouge">systemd</code> (the standard way to check services), we use a clever <code class="language-plaintext highlighter-rouge">netstat</code> command to verify the server is listening on port 80.</p> <p>Create <code class="language-plaintext highlighter-rouge">roles/nginx/tasks/main.yml</code>:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Update apt cache</span>
  <span class="na">ansible.builtin.apt</span><span class="pi">:</span>
    <span class="na">update_cache</span><span class="pi">:</span> <span class="s">yes</span>
    <span class="na">cache_valid_time</span><span class="pi">:</span> <span class="m">3600</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install nginx</span>
  <span class="na">ansible.builtin.apt</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">state</span><span class="pi">:</span> <span class="s">present</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Start nginx service</span>
  <span class="na">ansible.builtin.service</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">state</span><span class="pi">:</span> <span class="s">started</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="s">yes</span>

<span class="c1"># Docker-specific check: Verify port 80 is open</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Verify nginx is listening on port </span><span class="m">80</span>
  <span class="na">ansible.builtin.shell</span><span class="pi">:</span> <span class="s">netstat -tuln | grep :80 || ss -tuln | grep :80</span>
  <span class="na">register</span><span class="pi">:</span> <span class="s">nginx_check</span>
  <span class="na">ignore_errors</span><span class="pi">:</span> <span class="s">yes</span>

<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Print nginx port check</span>
  <span class="na">ansible.builtin.debug</span><span class="pi">:</span>
    <span class="na">msg</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Nginx</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">listening</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">port</span><span class="nv"> </span><span class="s">80"</span>
  <span class="na">when</span><span class="pi">:</span> <span class="s">nginx_check is succeeded</span>
</code></pre></div></div> <h3 id="step-3-the-playbook">Step 3: The Playbook</h3> <p>The playbook ties everything together. It maps the roles to the hosts. Create <code class="language-plaintext highlighter-rouge">playbooks/install-packages.yml</code>:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Configure all docker lab servers</span>
  <span class="na">hosts</span><span class="pi">:</span> <span class="s">docker_lab</span>
  <span class="na">become</span><span class="pi">:</span> <span class="s">yes</span>  <span class="c1"># Run as root (sudo)</span>
  
  <span class="na">roles</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">common</span>
    <span class="pi">-</span> <span class="s">nginx</span>
</code></pre></div></div> <hr> <h2 id="phase-4-execution-and-verification">Phase 4: Execution and Verification</h2> <h3 id="step-1-run-the-playbook">Step 1: Run the Playbook</h3> <p>This is the moment of truth. Run the following command from your project root:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ansible-playbook playbooks/install-packages.yml
</code></pre></div></div> <p>You will see Ansible connect to all three containers, install the tools, set up Nginx, and verify the ports.</p> <p><img src="https://github.com/prasadrgavande/prasadgavande.github.io/blob/master/assets/img/7-Ansible-guide/6-installations.png?raw=true" alt="PlaybookExecutionOutput1"> <img src="https://github.com/prasadrgavande/prasadgavande.github.io/blob/master/assets/img/7-Ansible-guide/6.1-installations.png?raw=true" alt="PlaybookExecutionOutput2"></p> <h3 id="step-2-verify-the-result">Step 2: Verify the Result</h3> <p>Let’s manually log into the <strong>TEST</strong> environment to confirm Nginx is serving traffic.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Log in via SSH (Password is 'password')</span>
ssh ansible-test@localhost <span class="nt">-p</span> 2222
</code></pre></div></div> <p><img src="https://github.com/prasadrgavande/prasadgavande.github.io/blob/master/assets/img/7-Ansible-guide/7-verify-ssh.png?raw=true" alt="SSH Verification"></p> <p>Once inside the container, run:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://localhost
</code></pre></div></div> <p>You should see the HTML for “Welcome to Nginx!”.</p> <p><img src="https://github.com/prasadrgavande/prasadgavande.github.io/blob/master/assets/img/7-Ansible-guide/8-verifyNginx.png?raw=true" alt="verify nginx"></p> <hr> <h2 id="conclusion">Conclusion</h2> <p>You have successfully built a multi-environment infrastructure simulation and deployed software to it using Ansible—all without spending a dime on cloud costs.</p> <p>You now have a portable lab where you can safely practice:</p> <ul> <li>Writing complex playbooks.</li> <li>Testing software upgrades.</li> <li>Experimenting with network configurations.</li> </ul> <p>Happy Automating!</p> </body></html>